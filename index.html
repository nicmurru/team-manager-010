    <script>
        // === CONFIGURAZIONE E DATI ===
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2ID-FSVHnEqYGDSM1yCNa9AZI-jXrpt5QbRbSA7ymGTPOqMdOoF-9K00u5OVTU0eN1w/exec';
        const STORAGE_KEY = 'teamManagerData_v4';

        // Credenziali (non visibili nell'interfaccia)
        const credentials = {
            manager: { username: 'admin', password: 'Olbia2025@' },
            member: { username: 'user', password: 'team456' }
        };

        // Dati di default con i membri reali del progetto
        const defaultMembers = [
            { id: 1, firstName: 'Mauro', lastName: 'Deligios', username: 'mdeligios', password: 'pass123', avatar: 'MD', createdAt: '2025-07-01T09:00:00.000Z' },
            { id: 2, firstName: 'Sebastiana', lastName: 'Unali', username: 'sunali', password: 'pass123', avatar: 'SU', createdAt: '2025-07-01T09:15:00.000Z' },
            { id: 3, firstName: 'Elisa', lastName: 'Pinna', username: 'epinna', password: 'pass123', avatar: 'EP', createdAt: '2025-07-01T09:30:00.000Z' },
            { id: 4, firstName: 'Valentina', lastName: 'Tolu', username: 'vtolu', password: 'pass123', avatar: 'VT', createdAt: '2025-07-01T09:45:00.000Z' },
            { id: 5, firstName: 'Arturo', lastName: 'Italia', username: 'aitalia', password: 'pass123', avatar: 'AI', createdAt: '2025-07-01T10:00:00.000Z' },
            { id: 6, firstName: 'Alessia', lastName: 'Folino', username: 'afolino', password: 'pass123', avatar: 'AF', createdAt: '2025-07-01T10:15:00.000Z' },
            { id: 7, firstName: 'Antonio', lastName: 'Mocci', username: 'amocci', password: 'pass123', avatar: 'AM', createdAt: '2025-07-01T10:30:00.000Z' },
            { id: 8, firstName: 'Laura', lastName: 'Casedda', username: 'lcasedda', password: 'pass123', avatar: 'LC', createdAt: '2025-07-01T10:45:00.000Z' },
            { id: 9, firstName: 'Victor Juan', lastName: 'Bergamo', username: 'vjbergamo', password: 'pass123', avatar: 'VB', createdAt: '2025-07-01T11:00:00.000Z' },
            { id: 10, firstName: 'Federico', lastName: 'Mureddu', username: 'fmureddu', password: 'pass123', avatar: 'FM', createdAt: '2025-07-01T11:15:00.000Z' },
            { id: 11, firstName: 'Caterina', lastName: 'Soro', username: 'csoro', password: 'pass123', avatar: 'CS', createdAt: '2025-07-01T11:30:00.000Z' },
            { id: 12, firstName: 'Marco', lastName: 'Marcato', username: 'mmarcato', password: 'pass123', avatar: 'MM', createdAt: '2025-07-01T11:45:00.000Z' }
        ];

        const defaultTasks = [
            { 
                id: 1, 
                name: 'Analisi Requisiti', 
                description: 'Raccolta e analisi dei requisiti del progetto', 
                members: [1, 2], 
                status: 'completed', 
                startDate: '2025-07-01', 
                endDate: '2025-07-05', 
                progress: 100, 
                difficulty: 2, 
                createdAt: '2025-07-01T10:00:00.000Z',
                assignedAt: '2025-07-01T10:00:00.000Z',
                completedAt: '2025-07-05T16:30:00.000Z',
                comments: [
                    { memberId: 1, comment: 'Completata analisi stakeholder e documentazione requisiti funzionali', timestamp: '2025-07-05T16:30:00.000Z' }
                ]
            },
            { 
                id: 2, 
                name: 'Design UI/UX', 
                description: 'Progettazione interfaccia utente e user experience', 
                members: [3, 4], 
                status: 'completed', 
                startDate: '2025-07-06', 
                endDate: '2025-07-12', 
                progress: 100, 
                difficulty: 3, 
                createdAt: '2025-07-01T10:15:00.000Z',
                assignedAt: '2025-07-01T10:15:00.000Z',
                completedAt: '2025-07-12T18:45:00.000Z',
                comments: [
                    { memberId: 3, comment: 'Wireframe e mockup completati, includendo versione mobile responsive', timestamp: '2025-07-12T18:45:00.000Z' }
                ]
            },
            { 
                id: 3, 
                name: 'Sviluppo Backend', 
                description: 'Implementazione logica server e database', 
                members: [5, 7, 10], 
                status: 'progress', 
                startDate: '2025-07-08', 
                endDate: '2025-07-18', 
                progress: 65, 
                difficulty: 3, 
                createdAt: '2025-07-01T10:30:00.000Z',
                assignedAt: '2025-07-01T10:30:00.000Z',
                comments: []
            },
            { 
                id: 4, 
                name: 'Sviluppo Frontend', 
                description: 'Sviluppo interfaccia utente responsive', 
                members: [6, 9], 
                status: 'progress', 
                startDate: '2025-07-13', 
                endDate: '2025-07-22', 
                progress: 40, 
                difficulty: 2, 
                createdAt: '2025-07-01T10:45:00.000Z',
                assignedAt: '2025-07-01T10:45:00.000Z',
                comments: []
            },
            { 
                id: 5, 
                name: 'Testing & QA', 
                description: 'Test funzionali e controllo qualità', 
                members: [8, 11, 12], 
                status: 'planning', 
                startDate: '2025-07-19', 
                endDate: '2025-07-25', 
                progress: 0, 
                difficulty: 2, 
                createdAt: '2025-07-01T11:00:00.000Z',
                assignedAt: '2025-07-01T11:00:00.000Z',
                comments: []
            }
        ];

        // Variabili globali
        let teamMembers = [];
        let tasks = [];
        let deletedTasks = [];
        let nextMemberId = 13;
        let nextTaskId = 6;
        let currentRole = null;
        let currentUser = null;
        let currentEditingMember = null;
        let currentEditingTask = null;
        let currentTaskView = 'active';

        // DOM Elements
        let loginScreen, dashboardScreen, usernameInput, passwordInput, loginButton, messageArea, userAvatar, userDisplayName, saveStatus;

        // === FUNZIONI DI TEST E DIAGNOSTICA ===
        async function testGoogleScriptConnection() {
            console.log('🔍 Test connessione Google Apps Script...');
            
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=test', {
                    method: 'GET'
                });
                
                const result = await response.json();
                console.log('✅ Risposta:', result);
                
                if (result.success) {
                    showMessage('✅ Connessione Google Script OK', 'success');
                    return true;
                }
            } catch (error) {
                console.log('❌ Errore:', error.message);
            }
            
            showMessage('❌ Connessione fallita. Verifica URL script', 'error');
            return false;
        }

        // === SISTEMA DI PERSISTENZA ===
        async function saveData() {
            try {
                showSaveStatus('saving');
                
                const data = {
                    teamMembers: teamMembers,
                    tasks: tasks,
                    deletedTasks: deletedTasks,
                    nextMemberId: nextMemberId,
                    nextTaskId: nextTaskId,
                    lastSaved: new Date().toISOString(),
                    version: 4
                };
                
                // Salva sempre localmente
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                
                // Prova a salvare su Google Apps Script
                try {
                    await saveToGoogleScript(data);
                    console.log('✅ Salvato su Google Apps Script');
                } catch (error) {
                    console.log('⚠️ Google Apps Script non raggiungibile:', error.message);
                }
                
                showSaveStatus('saved');
                return true;
                
            } catch (error) {
                console.error('❌ Errore nel salvataggio:', error);
                showSaveStatus('error');
                return false;
            }
        }

        function saveToGoogleScript(data) {
            return new Promise((resolve, reject) => {
                fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'saveData',
                        data: data
                    })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        resolve(result);
                    } else {
                        reject(new Error(result.error || 'Errore sconosciuto'));
                    }
                })
                .catch(reject);
            });
        }

        async function loadData() {
            try {
                // Prima prova localStorage
                const localData = localStorage.getItem(STORAGE_KEY);
                if (localData) {
                    const data = JSON.parse(localData);
                    if (data.version === 4) {
                        teamMembers = data.teamMembers || [...defaultMembers];
                        tasks = data.tasks || [...defaultTasks];
                        deletedTasks = data.deletedTasks || [];
                        nextMemberId = data.nextMemberId || 13;
                        nextTaskId = data.nextTaskId || 6;
                        console.log('✅ Dati caricati da localStorage');
                        return true;
                    }
                }
                
                // Se non ci sono dati locali, usa i default
                teamMembers = [...defaultMembers];
                tasks = [...defaultTasks];
                deletedTasks = [];
                nextMemberId = 13;
                nextTaskId = 6;
                
                console.log('🔄 Inizializzati dati di default');
                saveData();
                return true;
                
            } catch (error) {
                console.error('❌ Errore nel caricamento:', error);
                teamMembers = [...defaultMembers];
                tasks = [...defaultTasks];
                return true;
            }
        }

        function showSaveStatus(status) {
            const messages = {
                saving: '💾 Salvando...',
                saved: '✅ Salvato',
                error: '❌ Errore'
            };
            
            if (saveStatus) {
                saveStatus.textContent = messages[status];
                saveStatus.className = `save-status ${status}`;
                saveStatus.style.display = 'block';
                
                if (status === 'saved' || status === 'error') {
                    setTimeout(() => {
                        if (saveStatus) saveStatus.style.display = 'none';
                    }, 2000);
                }
            }
        }

        // === FUNZIONI UI ===
        function showMessage(text, type) {
            if (messageArea) {
                messageArea.textContent = text;
                messageArea.className = `message ${type}`;
                messageArea.style.display = 'block';
            }
        }

        function hideMessage() {
            if (messageArea) {
                messageArea.style.display = 'none';
            }
        }

        // === SISTEMA DI LOGIN ===
        function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            hideMessage();
            
            if (!username || !password) {
                showMessage('Inserisci username e password', 'error');
                return;
            }

            showMessage('Verificando credenziali...', 'success');
            
            loadData().then(() => {
                // Verifica Manager
                if (username === credentials.manager.username && password === credentials.manager.password) {
                    currentRole = 'manager';
                    currentUser = { username: username, role: 'manager', name: 'Admin Manager' };
                    loginSuccess();
                    return;
                }

                // Verifica Membro generico
                if (username === credentials.member.username && password === credentials.member.password) {
                    currentRole = 'member';
                    currentUser = { username: username, role: 'member', name: 'Team Member' };
                    loginSuccess();
                    return;
                }

                // Verifica membri personalizzati
                const member = teamMembers.find(m => m.username === username && m.password === password);
                if (member) {
                    currentRole = 'member';
                    currentUser = { 
                        username: username, 
                        role: 'member', 
                        name: `${member.firstName} ${member.lastName}`,
                        id: member.id,
                        avatar: member.avatar
                    };
                    loginSuccess();
                    return;
                }

                showMessage('Credenziali non valide', 'error');
            });
        }

        function loginSuccess() {
            showMessage('Accesso effettuato con successo!', 'success');
            
            setTimeout(() => {
                loginScreen.style.display = 'none';
                dashboardScreen.style.display = 'block';
                
                if (currentRole === 'manager') {
                    userDisplayName.textContent = currentUser.name;
                    userAvatar.textContent = 'AM';
                    document.querySelectorAll('.manager-only').forEach(el => el.classList.add('show'));
                    document.querySelectorAll('.member-only').forEach(el => el.classList.remove('show'));
                } else {
                    userDisplayName.textContent = currentUser.name;
                    userAvatar.textContent = currentUser.avatar || 'TM';
                    document.querySelectorAll('.manager-only').forEach(el => el.classList.remove('show'));
                    document.querySelectorAll('.member-only').forEach(el => el.classList.add('show'));
                }
                
                loadDashboard();
            }, 1000);
        }

        function logout() {
            dashboardScreen.style.display = 'none';
            loginScreen.style.display = 'flex';
            usernameInput.value = '';
            passwordInput.value = '';
            currentUser = null;
            currentRole = null;
        }

        // === DASHBOARD ===
        function loadDashboard() {
            updateStats();
            loadGanttChart();
            if (currentRole === 'manager') {
                loadTasksTable();
                loadMembersTable();
            } else {
                loadUserTasks();
            }
        }

        function updateStats() {
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('inProgressTasks').textContent = tasks.filter(t => t.status === 'progress').length;
            document.getElementById('completedTasks').textContent = tasks.filter(t => t.status === 'completed').length;
            document.getElementById('totalMembers').textContent = teamMembers.length;
        }

        function refreshData() {
            showMessage('Aggiornando...', 'success');
            loadData().then(() => {
                loadDashboard();
                showMessage('Dati aggiornati!', 'success');
                setTimeout(hideMessage, 2000);
            });
        }

        // === GANTT CHART ===
        function toggleTaskView(view) {
            currentTaskView = view;
            document.getElementById('showActiveBtn').classList.toggle('active', view === 'active');
            document.getElementById('showCompletedBtn').classList.toggle('active', view === 'completed');
            loadGanttChart();
        }

        function generateDateRange(startDate, endDate) {
            const dates = [];
            const start = new Date(startDate);
            const end = new Date(endDate);
            const current = new Date(start);
            
            while (current <= end) {
                dates.push(new Date(current));
                current.setDate(current.getDate() + 1);
            }
            return dates;
        }

        function loadGanttChart() {
            const container = document.getElementById('ganttContainer');
            container.innerHTML = '';
            
            // Filtra task in base alla vista corrente
            const filteredTasks = currentTaskView === 'active' 
                ? tasks.filter(t => t.status !== 'completed')
                : tasks.filter(t => t.status === 'completed');
            
            if (filteredTasks.length === 0) {
                const message = currentTaskView === 'active' ? 'Nessuna attività in corso' : 'Nessuna attività completata';
                container.innerHTML = `<div style="padding: 40px; text-align: center; color: #64748b;"><h3>📋 ${message}</h3></div>`;
                return;
            }
            
            const projectStart = new Date('2025-07-01');
            const projectEnd = new Date('2025-07-31');
            const dateRange = generateDateRange(projectStart, projectEnd);
            const dayWidth = 40;

            // Header
            const header = document.createElement('div');
            header.className = 'gantt-header';
            
            const taskColumn = document.createElement('div');
            taskColumn.className = 'gantt-task-column';
            taskColumn.textContent = 'Attività';
            header.appendChild(taskColumn);

            const timelineHeader = document.createElement('div');
            timelineHeader.className = 'gantt-timeline-header';
            dateRange.forEach(date => {
                const dateCell = document.createElement('div');
                dateCell.className = 'gantt-date-cell';
                dateCell.style.minWidth = dayWidth + 'px';
                dateCell.textContent = `${date.getDate()}/${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                timelineHeader.appendChild(dateCell);
            });
            header.appendChild(timelineHeader);
            container.appendChild(header);

            // Task rows
            filteredTasks.forEach(task => {
                const row = document.createElement('div');
                row.className = 'gantt-row';

                const taskInfo = document.createElement('div');
                taskInfo.className = 'gantt-task-info';
                
                const taskName = document.createElement('div');
                taskName.className = 'task-name';
                taskName.textContent = task.name;
                taskInfo.appendChild(taskName);

                const taskMembers = document.createElement('div');
                taskMembers.className = 'task-members';
                task.members.forEach(memberId => {
                    const member = teamMembers.find(m => m.id === memberId);
                    if (member) {
                        const memberTag = document.createElement('span');
                        memberTag.className = 'member-tag';
                        memberTag.textContent = member.avatar;
                        taskMembers.appendChild(memberTag);
                    }
                });
                taskInfo.appendChild(taskMembers);

                // Mostra commenti se l'attività è completata
                if (task.status === 'completed' && task.comments && task.comments.length > 0) {
                    const commentsDiv = document.createElement('div');
                    commentsDiv.className = 'task-comments';
                    task.comments.forEach(comment => {
                        const member = teamMembers.find(m => m.id === comment.memberId);
                        const memberName = member ? `${member.firstName} ${member.lastName}` : 'Sconosciuto';
                        commentsDiv.innerHTML += `<div><strong>${memberName}:</strong> ${comment.comment}</div>`;
                    });
                    taskInfo.appendChild(commentsDiv);
                }

                // Timeline
                const timeline = document.createElement('div');
                timeline.className = 'gantt-timeline';
                dateRange.forEach(() => {
                    const dateColumn = document.createElement('div');
                    dateColumn.className = 'gantt-date-column';
                    dateColumn.style.minWidth = dayWidth + 'px';
                    timeline.appendChild(dateColumn);
                });

                const taskStart = new Date(task.startDate);
                const taskEnd = new Date(task.endDate);
                const startOffset = Math.floor((taskStart - projectStart) / (1000 * 60 * 60 * 24));
                const duration = Math.floor((taskEnd - taskStart) / (1000 * 60 * 60 * 24)) + 1;

                const taskBar = document.createElement('div');
                taskBar.className = `gantt-bar progress-${task.status}`;
                taskBar.style.left = (startOffset * dayWidth + 5) + 'px';
                taskBar.style.width = (duration * dayWidth - 10) + 'px';
                
                if (task.status === 'completed' && task.completedAt) {
                    const completedDate = new Date(task.completedAt).toLocaleDateString('it-IT');
                    taskBar.textContent = `Completata ${completedDate}`;
                } else {
                    taskBar.textContent = `${duration}g (${task.progress}%)`;
                }

                timeline.appendChild(taskBar);
                row.appendChild(taskInfo);
                row.appendChild(timeline);
                container.appendChild(row);
            });
        }

        // === GESTIONE MEMBRI ===
        function editMember(memberId) {
            const member = teamMembers.find(m => m.id === memberId);
            if (member) {
                currentEditingMember = member;
                document.getElementById('modalTitle').textContent = 'Modifica Membro';
                document.getElementById('memberFirstName').value = member.firstName;
                document.getElementById('memberLastName').value = member.lastName;
                document.getElementById('memberUsername').value = member.username;
                document.getElementById('memberPassword').value = member.password;
                showModal('memberModal');
            }
        }

        function deleteMember(memberId) {
            if (confirm('Eliminare questo membro?')) {
                teamMembers = teamMembers.filter(m => m.id !== memberId);
                tasks.forEach(task => {
                    task.members = task.members.filter(id => id !== memberId);
                });
                
                saveData();
                loadMembersTable();
                loadTasksTable();
                loadGanttChart();
                updateStats();
                showMessage('Membro eliminato!', 'success');
                setTimeout(hideMessage, 2000);
            }
        }

        function openAddMemberModal() {
            currentEditingMember = null;
            document.getElementById('modalTitle').textContent = 'Aggiungi Nuovo Membro';
            document.getElementById('memberFirstName').value = '';
            document.getElementById('memberLastName').value = '';
            document.getElementById('memberUsername').value = '';
            document.getElementById('memberPassword').value = '';
            showModal('memberModal');
        }

        function saveMemberData() {
            const firstName = document.getElementById('memberFirstName').value.trim();
            const lastName = document.getElementById('memberLastName').value.trim();
            const username = document.getElementById('memberUsername').value.trim();
            const password = document.getElementById('memberPassword').value.trim();

            if (!firstName || !lastName || !username || !password) {
                showMessage('Compila tutti i campi', 'error');
                return;
            }

            if (currentEditingMember) {
                currentEditingMember.firstName = firstName;
                currentEditingMember.lastName = lastName;
                currentEditingMember.username = username;
                currentEditingMember.password = password;
                currentEditingMember.avatar = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();
            } else {
                const newMember = {
                    id: nextMemberId++,
                    firstName,
                    lastName,
                    username,
                    password,
                    avatar: (firstName.charAt(0) + lastName.charAt(0)).toUpperCase(),
                    createdAt: new Date().toISOString()
                };
                teamMembers.push(newMember);
            }

            saveData();
            closeMemberModal();
            loadMembersTable();
            updateStats();
            showMessage('Membro salvato!', 'success');
            setTimeout(hideMessage, 2000);
        }

        function loadMembersTable() {
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = '';

            teamMembers.forEach(member => {
                const assignedTasks = tasks.filter(task => task.members.includes(member.id)).length;
                const row = document.createElement('tr');
                
                // Nome
                const nameCell = document.createElement('td');
                const nameContainer = document.createElement('div');
                nameContainer.style.display = 'flex';
                nameContainer.style.alignItems = 'center';
                nameContainer.style.gap = '10px';
                
                const memberTag = document.createElement('div');
                memberTag.className = 'member-tag';
                memberTag.textContent = member.avatar;
                
                const memberName = document.createElement('strong');
                memberName.textContent = `${member.firstName} ${member.lastName}`;
                
                nameContainer.appendChild(memberTag);
                nameContainer.appendChild(memberName);
                nameCell.appendChild(nameContainer);
                
                // Username
                const usernameCell = document.createElement('td');
                usernameCell.textContent = member.username;
                
                // Attività
                const tasksCell = document.createElement('td');
                tasksCell.textContent = `${assignedTasks} attività`;
                
                // Azioni
                const actionsCell = document.createElement('td');
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-primary';
                editBtn.textContent = '✏️';
                editBtn.onclick = () => editMember(member.id);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = '🗑️';
                deleteBtn.style.marginLeft = '5px';
                deleteBtn.onclick = () => deleteMember(member.id);
                
                actionsCell.appendChild(editBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(nameCell);
                row.appendChild(usernameCell);
                row.appendChild(tasksCell);
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
        }

        // === GESTIONE ATTIVITÀ ===
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                currentEditingTask = task;
                document.getElementById('taskModalTitle').textContent = 'Modifica Attività';
                document.getElementById('taskName').value = task.name;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskStartDate').value = task.startDate;
                document.getElementById('taskEndDate').value = task.endDate;
                
                document.querySelectorAll('.difficulty-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (parseInt(opt.dataset.difficulty) === task.difficulty) {
                        opt.classList.add('selected');
                    }
                });
                
                loadMembersSelector(task.members);
                showModal('taskModal');
            }
        }

        function deleteTask(taskId) {
            if (confirm('Eliminare questa attività?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveData();
                loadTasksTable();
                loadGanttChart();
                updateStats();
                showMessage('Attività eliminata!', 'success');
                setTimeout(hideMessage, 2000);
            }
        }

        function openAddTaskModal() {
            currentEditingTask = null;
            document.getElementById('taskModalTitle').textContent = 'Nuova Attività';
            document.getElementById('taskName').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskStartDate').value = '';
            document.getElementById('taskEndDate').value = '';
            
            document.querySelectorAll('.difficulty-option').forEach(opt => opt.classList.remove('selected'));
            loadMembersSelector();
            showModal('taskModal');
        }

        function saveTaskData() {
            const name = document.getElementById('taskName').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const startDate = document.getElementById('taskStartDate').value;
            const endDate = document.getElementById('taskEndDate').value;
            
            const selectedDifficulty = document.querySelector('.difficulty-option.selected');
            const selectedMembers = Array.from(document.querySelectorAll('.member-checkbox input:checked')).map(cb => parseInt(cb.value));

            if (!name || !description || !startDate || !endDate || !selectedDifficulty || selectedMembers.length === 0) {
                showMessage('Compila tutti i campi', 'error');
                return;
            }

            const difficulty = parseInt(selectedDifficulty.dataset.difficulty);

            if (currentEditingTask) {
                currentEditingTask.name = name;
                currentEditingTask.description = description;
                currentEditingTask.startDate = startDate;
                currentEditingTask.endDate = endDate;
                currentEditingTask.difficulty = difficulty;
                currentEditingTask.members = selectedMembers;
            } else {
                const newTask = {
                    id: nextTaskId++,
                    name,
                    description,
                    startDate,
                    endDate,
                    difficulty,
                    members: selectedMembers,
                    status: 'planning',
                    progress: 0,
                    createdAt: new Date().toISOString(),
                    assignedAt: new Date().toISOString(),
                    comments: []
                };
                tasks.push(newTask);
            }

            saveData();
            closeTaskModal();
            loadTasksTable();
            loadGanttChart();
            updateStats();
            showMessage('Attività salvata!', 'success');
            setTimeout(hideMessage, 2000);
        }

        function loadMembersSelector(selectedMembers = []) {
            const container = document.getElementById('membersSelector');
            container.innerHTML = '';

            teamMembers.forEach(member => {
                const div = document.createElement('div');
                div.className = 'member-checkbox';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = member.id;
                checkbox.checked = selectedMembers.includes(member.id);
                
                const avatar = document.createElement('div');
                avatar.className = 'member-checkbox-avatar';
                avatar.textContent = member.avatar;
                
                const label = document.createElement('span');
                label.textContent = `${member.firstName} ${member.lastName}`;
                
                div.appendChild(checkbox);
                div.appendChild(avatar);
                div.appendChild(label);
                container.appendChild(div);
            });
        }

        function loadTasksTable() {
            const tbody = document.getElementById('tasksTableBody');
            tbody.innerHTML = '';

            const statusLabels = {
                'planning': 'PIANIFICAZIONE',
                'progress': 'IN CORSO',
                'completed': 'COMPLETATA',
                'review': 'IN REVISIONE'
            };

            tasks.forEach(task => {
                const row = document.createElement('tr');
                
                // Nome
                const nameCell = document.createElement('td');
                nameCell.innerHTML = `<strong>${task.name}</strong><br><small>${task.description}</small>`;
                
                // Membri
                const membersCell = document.createElement('td');
                task.members.forEach(memberId => {
                    const member = teamMembers.find(m => m.id === memberId);
                    if (member) {
                        const tag = document.createElement('span');
                        tag.className = 'member-tag';
                        tag.textContent = member.avatar;
                        tag.style.marginRight = '4px';
                        membersCell.appendChild(tag);
                    }
                });
                
                // Date
                const datesCell = document.createElement('td');
                datesCell.innerHTML = `${formatDate(task.startDate)} - ${formatDate(task.endDate)}`;
                if (task.completedAt) {
                    datesCell.innerHTML += `<br><small>Completata: ${formatDateTime(task.completedAt)}</small>`;
                }
                
                // Stato
                const statusCell = document.createElement('td');
                const statusSpan = document.createElement('span');
                statusSpan.className = `task-card-status status-${task.status}`;
                statusSpan.textContent = statusLabels[task.status];
                statusCell.appendChild(statusSpan);
                
                // Azioni
                const actionsCell = document.createElement('td');
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-primary';
                editBtn.textContent = '✏️';
                editBtn.onclick = () => editTask(task.id);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = '🗑️';
                deleteBtn.style.marginLeft = '5px';
                deleteBtn.onclick = () => deleteTask(task.id);
                
                actionsCell.appendChild(editBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(nameCell);
                row.appendChild(membersCell);
                row.appendChild(datesCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
        }

        // === GESTIONE ATTIVITÀ UTENTE ===
        function loadUserTasks() {
            if (!currentUser || !currentUser.id) return;
            
            const userTasks = tasks.filter(task => task.members.includes(currentUser.id) && task.status !== 'completed');
            const container = document.getElementById('userTasksList');
            container.innerHTML = '';

            if (userTasks.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;"><h3>📝 Nessuna attività assegnata o tutte completate</h3></div>';
                return;
            }

            const statusLabels = {
                'planning': 'Pianificazione',
                'progress': 'In Corso',
                'completed': 'Completata',
                'review': 'In Revisione'
            };

            userTasks.forEach(task => {
                const card = document.createElement('div');
                card.className = `user-task-card ${task.status === 'completed' ? 'completed' : ''}`;
                
                card.innerHTML = `
                    <div class="task-card-header">
                        <div class="task-card-title">${task.name}</div>
                        <span class="task-card-status status-${task.status}">${statusLabels[task.status]}</span>
                    </div>
                    <div class="task-card-description">${task.description}</div>
                    <div class="task-card-info">
                        <div class="task-info-item">
                            <div class="task-info-label">Data Inizio</div>
                            <div class="task-info-value">${formatDate(task.startDate)}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Data Fine</div>
                            <div class="task-info-value">${formatDate(task.endDate)}</div>
                        </div>
                    </div>
                    <div class="completion-section">
                        <textarea class="completion-textarea" id="comment-${task.id}" placeholder="Aggiungi un commento sul completamento dell'attività..."></textarea>
                        <div class="completion-checkbox">
                            <input type="checkbox" id="task-${task.id}" ${task.status === 'completed' ? 'checked' : ''}>
                            <label for="task-${task.id}">Marca come completata</label>
                        </div>
                    </div>
                `;
                
                const checkbox = card.querySelector(`#task-${task.id}`);
                const commentTextarea = card.querySelector(`#comment-${task.id}`);
                
                checkbox.addEventListener('change', () => completeTask(task.id, checkbox.checked, commentTextarea.value));
                
                container.appendChild(card);
            });
        }

        function completeTask(taskId, isCompleted, comment) {
            const task = tasks.find(t => t.id === taskId);
            if (task && isCompleted) {
                if (!comment.trim()) {
                    showMessage('Inserisci un commento per completare l\'attività', 'error');
                    const checkbox = document.querySelector(`#task-${taskId}`);
                    if (checkbox) checkbox.checked = false;
                    return;
                }
                
                task.status = 'completed';
                task.progress = 100;
                task.completedAt = new Date().toISOString();
                
                // Aggiungi il commento
                if (!task.comments) task.comments = [];
                task.comments.push({
                    memberId: currentUser.id,
                    comment: comment.trim(),
                    timestamp: new Date().toISOString()
                });
                
                saveData();
                loadGanttChart();
                loadUserTasks();
                updateStats();
                showMessage('Attività completata!', 'success');
                setTimeout(hideMessage, 3000);
            }
        }

        // === GESTIONE MODALI ===
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                modal.style.display = 'flex';
            }
        }

        function closeMemberModal() {
            const modal = document.getElementById('memberModal');
            if (modal) {
                modal.classList.remove('show');
                modal.style.display = 'none';
            }
        }

        function closeTaskModal() {
            const modal = document.getElementById('taskModal');
            if (modal) {
                modal.classList.remove('show');
                modal.style.display = 'none';
            }
        }

        // === UTILITY ===
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('it-IT');
        }

        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('it-IT') + ' ' + date.toLocaleTimeString('it-IT', {hour: '2-digit', minute: '2-digit'});
        }

        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nome,Descrizione,Membri,Data Assegnazione,Data Inizio,Data Fine,Data Completamento,Stato,Progresso,Difficoltà,Commenti\n";
            
            csvContent += tasks.map(task => {
                const memberNames = task.members.map(id => {
                    const member = teamMembers.find(m => m.id === id);
                    return member ? `${member.firstName} ${member.lastName}` : '';
                }).join('; ');
                
                const comments = task.comments ? task.comments.map(c => {
                    const member = teamMembers.find(m => m.id === c.memberId);
                    const memberName = member ? `${member.firstName} ${member.lastName}` : 'Sconosciuto';
                    return `${memberName}: ${c.comment}`;
                }).join(' | ') : '';
                
                const assignedAt = task.assignedAt ? formatDateTime(task.assignedAt) : '';
                const completedAt = task.completedAt ? formatDateTime(task.completedAt) : '';
                
                return `"${task.name}","${task.description}","${memberNames}","${assignedAt}","${task.startDate}","${task.endDate}","${completedAt}","${task.status}","${task.progress}%","${task.difficulty}","${comments}"`;
            }).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `team_manager_export_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('Dati esportati!', 'success');
            setTimeout(hideMessage, 2000);
        }

        // === INIZIALIZZAZIONE ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inizializzazione Team Manager...');
            
            // Inizializza elementi DOM
            loginScreen = document.getElementById('loginScreen');
            dashboardScreen = document.getElementById('dashboardScreen');
            usernameInput = document.getElementById('usernameInput');
            passwordInput = document.getElementById('passwordInput');
            loginButton = document.getElementById('loginButton');
            messageArea = document.getElementById('messageArea');
            userAvatar = document.getElementById('userAvatar');
            userDisplayName = document.getElementById('userDisplayName');
            saveStatus = document.getElementById('saveStatus');
            
            // Event listeners
            loginButton.addEventListener('click', handleLogin);
            usernameInput.addEventListener('keypress', e => e.key === 'Enter' && handleLogin());
            passwordInput.addEventListener('keypress', e => e.key === 'Enter' && handleLogin());
            
            // Difficulty selector
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('difficulty-option')) {
                    document.querySelectorAll('.difficulty-option').forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });

            // Close modal on outside click
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeMemberModal();
                    closeTaskModal();
                }
            });
            
            // Salva quando chiudi pagina
            window.addEventListener('beforeunload', () => {
                if (currentUser) saveData();
            });
            
            // Carica dati all'avvio
            loadData().then(() => {
                console.log('✅ App inizializzata');
                console.log('📊 Membri:', teamMembers.length, '- Attività:', tasks.length);
            });
        });

        // Rendi le funzioni disponibili globalmente
        window.openAddMemberModal = openAddMemberModal;
        window.openAddTaskModal = openAddTaskModal;
        window.closeMemberModal = closeMemberModal;
        window.closeTaskModal = closeTaskModal;
        window.saveMemberData = saveMemberData;
        window.saveTaskData = saveTaskData;
        window.logout = logout;
        window.refreshData = refreshData;
        window.exportToExcel = exportToExcel;
        window.completeTask = completeTask;
        window.editMember = editMember;
        window.deleteMember = deleteMember;
        window.editTask = editTask;
        window.deleteTask = deleteTask;
        window.toggleTaskView = toggleTaskView;
        window.testGoogleScriptConnection = testGoogleScriptConnection;
    </script>
</body>
</html><!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Manager - Commessa 162</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #334155;
            line-height: 1.6;
        }

        /* LOGIN STYLES */
        #loginScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px 40px 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Logo Manelli SVG */
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-svg {
            width: 200px;
            height: auto;
            margin-bottom: 10px;
        }

        .commessa-text {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .logo h1 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
            margin-top: 20px;
        }

        .logo p {
            color: #666;
            font-size: 14px;
            text-align: center;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #loginButton {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        #loginButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            display: none;
        }

        .error {
            background: rgba(255, 82, 82, 0.1);
            color: #ff5252;
            border: 1px solid rgba(255, 82, 82, 0.2);
        }

        .success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        /* DASHBOARD STYLES */
        #dashboardScreen {
            display: none;
            background: #f8fafc;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .stat-card h3 {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .section-header {
            background: #f8fafc;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 20px;
            color: #1e293b;
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* Manager/Member specific sections */
        .manager-only {
            display: none !important;
        }

        .manager-only.show {
            display: block !important;
        }

        .member-only {
            display: none !important;
        }

        .member-only.show {
            display: block !important;
        }

        /* Filter Controls */
        .filter-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-toggle {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-toggle.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Gantt Chart */
        .gantt-container {
            min-width: 1000px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .gantt-header {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .gantt-task-column {
            width: 300px;
            padding: 12px;
            font-weight: 600;
            color: #1e293b;
            border-right: 1px solid #e2e8f0;
        }

        .gantt-timeline-header {
            flex: 1;
            display: flex;
        }

        .gantt-date-cell {
            min-width: 40px;
            padding: 8px 4px;
            text-align: center;
            border-right: 1px solid #e2e8f0;
            font-size: 11px;
            font-weight: 500;
            color: #64748b;
        }

        .gantt-row {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            min-height: 60px;
            align-items: center;
        }

        .gantt-task-info {
            width: 300px;
            padding: 12px;
            border-right: 1px solid #e2e8f0;
        }

        .gantt-timeline {
            flex: 1;
            display: flex;
            position: relative;
            align-items: center;
            min-height: 60px;
        }

        .gantt-date-column {
            min-width: 40px;
            height: 100%;
            border-right: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
        }

        .gantt-bar {
            position: absolute;
            height: 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: 600;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gantt-bar:hover {
            transform: scaleY(1.2);
            z-index: 3;
        }

        .gantt-area {
            padding: 20px;
            overflow-x: auto;
        }

        .task-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1e293b;
        }

        .task-members {
            display: flex;
            gap: 4px;
            margin-top: 5px;
        }

        .member-tag {
            background: #667eea;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        .task-comments {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
            font-style: italic;
        }

        .progress-completed { background: #10b981; }
        .progress-progress { background: #3b82f6; }
        .progress-planning { background: #f59e0b; }
        .progress-review { background: #f97316; }

        /* Tables */
        .tasks-table-container,
        .members-table-container {
            padding: 20px;
            overflow-x: auto;
        }

        .tasks-table,
        .members-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .tasks-table th,
        .tasks-table td,
        .members-table th,
        .members-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .tasks-table th,
        .members-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #1e293b;
            position: sticky;
            top: 0;
        }

        .tasks-table tr:hover,
        .members-table tr:hover {
            background: #f8fafc;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h3 {
            margin: 0;
            color: #1e293b;
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        /* Task Management */
        .task-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .task-form-full {
            grid-column: 1 / -1;
        }

        .members-selector {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .member-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .member-checkbox:hover {
            background: #e2e8f0;
        }

        .member-checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .member-checkbox-avatar {
            width: 25px;
            height: 25px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .difficulty-option {
            padding: 8px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: center;
            min-width: 60px;
        }

        .difficulty-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .difficulty-1 { border-color: #10b981; }
        .difficulty-1.selected { background: #10b981; }
        .difficulty-2 { border-color: #f59e0b; }
        .difficulty-2.selected { background: #f59e0b; }
        .difficulty-3 { border-color: #ef4444; }
        .difficulty-3.selected { background: #ef4444; }

        /* User Tasks Styles */
        .user-tasks-container {
            padding: 20px;
        }

        .user-task-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .user-task-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .user-task-card.completed {
            opacity: 0.7;
            background: #f0fdf4;
            border-color: #22c55e;
        }

        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .task-card-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-planning { background: #fef3c7; color: #92400e; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #dcfce7; color: #166534; }
        .status-review { background: #fed7d7; color: #c53030; }

        .task-card-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-info-item {
            font-size: 14px;
        }

        .task-info-label {
            font-weight: 500;
            color: #64748b;
            margin-bottom: 2px;
        }

        .task-info-value {
            color: #1e293b;
        }

        .task-card-description {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #475569;
            border-left: 3px solid #667eea;
        }

        .completion-section {
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
            margin-top: 15px;
        }

        .completion-textarea {
            width: 100%;
            min-height: 80px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            resize: vertical;
        }

        .completion-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .completion-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .completion-checkbox label {
            font-weight: 500;
            color: #1e293b;
            cursor: pointer;
        }

        /* Save Status */
        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1001;
            transition: all 0.3s ease;
            display: none;
        }

        .save-status.saving {
            background: #fef3c7;
            color: #92400e;
        }

        .save-status.saved {
            background: #dcfce7;
            color: #166534;
        }

        .save-status.error {
            background: #fecaca;
            color: #dc2626;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            .modal-content {
                margin: 10px;
                padding: 20px;
            }
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            .section-actions {
                width: 100%;
                justify-content: flex-start;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .task-form-grid {
                grid-template-columns: 1fr;
            }
            .task-card-info {
                grid-template-columns: 1fr;
            }
            .filter-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Save Status -->
    <div id="saveStatus" class="save-status"></div>

    <!-- LOGIN SCREEN -->
    <div id="loginScreen">
        <div class="login-box">
            <div class="logo-container">
                <!-- Logo Manelli SVG -->
                <svg class="logo-svg" viewBox="0 0 416 165" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M38.4 124H20V80.8C20 76.5333 19.0667 73.3333 17.2 71.2C15.3333 68.9333 12.8 67.8 9.6 67.8C6.26667 67.8 3.6 68.9333 1.6 71.2C-0.266667 73.3333 -1.2 76.5333 -1.2 80.8V124H-19.6V80.8C-19.6 76.5333 -20.5333 73.3333 -22.4 71.2C-24.2667 68.9333 -26.8 67.8 -30 67.8C-33.3333 67.8 -36 68.9333 -38 71.2C-39.8667 73.3333 -40.8 76.5333 -40.8 80.8V124H-59.2V52H-40.8V58.6C-39.0667 56.0667 -36.7333 54.0667 -33.8 52.6C-30.8667 51 -27.5333 50.2 -23.8 50.2C-19.4 50.2 -15.4667 51.2667 -12 53.4C-8.53333 55.4 -5.86667 58.3333 -4 62.2C-2 58.3333 0.8 55.4 4.4 53.4C8.13333 51.2667 12.2667 50.2 16.8 50.2C24.2667 50.2 30.2667 52.6 34.8 57.4C39.3333 62.2 41.6 68.6 41.6 76.6V124H38.4Z" fill="#1A323A"/>
                    <path d="M88.1719 126C82.3052 126 77.1052 124.6 72.5719 121.8C68.0385 119 64.5052 115.133 61.9719 110.2C59.4385 105.133 58.1719 99.4 58.1719 93C58.1719 82.6 61.2385 74.3333 67.3719 68.2C73.5052 62.0667 81.7052 59 91.9719 59C97.8385 59 103.105 60.4 107.772 63.2C112.439 66 116.105 69.9333 118.772 75C121.439 79.9333 122.772 85.6667 122.772 92.2V96.8H76.5719C76.7052 101.2 78.1052 104.667 80.7719 107.2C83.5719 109.6 87.1719 110.8 91.5719 110.8C98.7719 110.8 103.972 108.067 107.172 102.6L119.572 110.8C117.172 115.2 113.639 118.667 108.972 121.2C104.305 123.733 97.0385 126 88.1719 126ZM91.9719 74.2C88.2385 74.2 85.1719 75.3333 82.7719 77.6C80.5052 79.8667 79.1052 83 78.5719 87H105.372C104.839 83 103.372 79.8667 100.972 77.6C98.7052 75.3333 95.7052 74.2 91.9719 74.2Z" fill="#1A323A"/>
                    <path d="M159.044 126C153.311 126 148.244 124.667 143.844 122C139.444 119.2 135.978 115.333 133.444 110.4C131.044 105.333 129.844 99.5333 129.844 93C129.844 86.3333 131.044 80.5333 133.444 75.6C135.978 70.5333 139.444 66.6667 143.844 64C148.244 61.3333 153.311 60 159.044 60C164.778 60 169.844 61.3333 174.244 64C178.644 66.6667 182.044 70.5333 184.444 75.6C186.978 80.5333 188.244 86.3333 188.244 93C188.244 99.5333 186.978 105.333 184.444 110.4C182.044 115.333 178.644 119.2 174.244 122C169.844 124.667 164.778 126 159.044 126ZM159.044 108.8C163.311 108.8 166.711 107.133 169.244 103.8C171.778 100.467 173.044 95.8 173.044 89.8V96.2C173.044 90.2 171.778 85.5333 169.244 82.2C166.711 78.8667 163.311 77.2 159.044 77.2C154.778 77.2 151.378 78.8667 148.844 82.2C146.311 85.5333 145.044 90.2 145.044 96.2V89.8C145.044 95.8 146.311 100.467 148.844 103.8C151.378 107.133 154.778 108.8 159.044 108.8Z" fill="#1A323A"/>
                    <path d="M240 80.8C240 76.5333 239.067 73.3333 237.2 71.2C235.333 68.9333 232.8 67.8 229.6 67.8C226.267 67.8 223.6 68.9333 221.6 71.2C219.733 73.3333 218.8 76.5333 218.8 80.8V124H200.4V52H218.8V58.6C220.533 56.0667 222.867 54.0667 225.8 52.6C228.867 51 232.333 50.2 236.2 50.2C243.667 50.2 249.667 52.6 254.2 57.4C258.733 62.2 261 68.6 261 76.6V124H242.6V80.8H240Z" fill="#1A323A"/>
                    <path d="M288.172 126C282.305 126 277.105 124.6 272.572 121.8C268.039 119 264.505 115.133 261.972 110.2C259.439 105.133 258.172 99.4 258.172 93C258.172 82.6 261.239 74.3333 267.372 68.2C273.505 62.0667 281.705 59 291.972 59C297.839 59 303.105 60.4 307.772 63.2C312.439 66 316.105 69.9333 318.772 75C321.439 79.9333 322.772 85.6667 322.772 92.2V96.8H276.572C276.705 101.2 278.105 104.667 280.772 107.2C283.572 109.6 287.172 110.8 291.572 110.8C298.772 110.8 303.972 108.067 307.172 102.6L319.572 110.8C317.172 115.2 313.639 118.667 308.972 121.2C304.305 123.733 297.039 126 288.172 126ZM291.972 74.2C288.239 74.2 285.172 75.3333 282.772 77.6C280.505 79.8667 279.105 83 278.572 87H305.372C304.839 83 303.372 79.8667 300.972 77.6C298.705 75.3333 295.705 74.2 291.972 74.2Z" fill="#1A323A"/>
                    <path d="M339.044 124V32.8H357.444V124H339.044Z" fill="#1A323A"/>
                    <path d="M375.816 124V32.8H394.216V124H375.816Z" fill="#1A323A"/>
                    <path d="M285.216 68H283.216V70V124V126H285.216H339.216H341.216V124V70V68H339.216H285.216Z" fill="#1A323A" stroke="white" stroke-width="4"/>
                    <path d="M80.4824 137.896V145H87.1704V146.416H80.4824V153.52H88.2504V155H78.7944V136.416H88.2504V137.896H80.4824Z" fill="#1A323A"/>
                    <path d="M104.299 155.168C102.603 155.168 101.075 154.768 99.7145 153.968C98.3545 153.152 97.2825 152.024 96.4985 150.584C95.7305 149.144 95.3465 147.504 95.3465 145.664C95.3465 143.824 95.7305 142.192 96.4985 140.768C97.2825 139.328 98.3545 138.208 99.7145 137.408C101.075 136.592 102.603 136.184 104.299 136.184C106.155 136.184 107.779 136.648 109.171 137.576C110.579 138.488 111.587 139.752 112.195 141.368L110.651 142.064C110.139 140.72 109.323 139.664 108.203 138.896C107.083 138.128 105.779 137.744 104.291 137.744C102.883 137.744 101.619 138.088 100.499 138.776C99.3785 139.448 98.4985 140.392 97.8585 141.608C97.2185 142.824 96.8985 144.184 96.8985 145.688C96.8985 147.208 97.2185 148.576 97.8585 149.792C98.4985 150.992 99.3785 151.936 100.499 152.624C101.619 153.296 102.883 153.632 104.291 153.632C105.779 153.632 107.083 153.248 108.203 152.48C109.323 151.712 110.139 150.656 110.651 149.312L112.195 150.008C111.587 151.624 110.579 152.896 109.171 153.824C107.779 154.736 106.155 155.192 104.299 155.168Z" fill="#1A323A"/>
                    <path d="M120.154 155.168C118.458 155.168 116.93 154.768 115.57 153.968C114.21 153.152 113.138 152.024 112.354 150.584C111.586 149.144 111.202 147.504 111.202 145.664C111.202 143.824 111.586 142.192 112.354 140.768C113.138 139.328 114.21 138.208 115.57 137.408C116.93 136.592 118.458 136.184 120.154 136.184C121.85 136.184 123.37 136.592 124.714 137.408C126.074 138.208 127.146 139.328 127.93 140.768C128.714 142.192 129.106 143.824 129.106 145.664C129.106 147.504 128.714 149.144 127.93 150.584C127.146 152.024 126.074 153.152 124.714 153.968C123.37 154.768 121.85 155.168 120.154 155.168ZM120.154 153.632C121.562 153.632 122.826 153.296 123.946 152.624C125.066 151.936 125.946 150.992 126.586 149.792C127.226 148.576 127.546 147.208 127.546 145.688C127.546 144.168 127.226 142.808 126.586 141.608C125.946 140.392 125.066 139.448 123.946 138.776C122.826 138.088 121.562 137.744 120.154 137.744C118.746 137.744 117.474 138.088 116.338 138.776C115.218 139.448 114.338 140.392 113.698 141.608C113.058 142.824 112.738 144.184 112.738 145.688C112.738 147.208 113.058 148.576 113.698 149.792C114.338 150.992 115.218 151.936 116.338 152.624C117.474 153.296 118.746 153.632 120.154 153.632Z" fill="#1A323A"/>
                    <path d="M145.095 141.56C144.807 140.024 144.103 138.832 142.983 137.984C141.863 137.12 140.439 136.688 138.711 136.688C137.543 136.688 136.487 136.92 135.543 137.384C134.615 137.832 133.879 138.456 133.335 139.256C132.791 140.04 132.519 140.928 132.519 141.92C132.519 142.976 132.807 143.856 133.383 144.56C133.975 145.264 134.847 145.824 135.999 146.24L140.415 147.776C141.951 148.32 143.087 149.096 143.823 150.104C144.559 151.096 144.927 152.28 144.927 153.656C144.927 154.792 144.631 155.8 144.039 156.68C143.447 157.56 142.615 158.256 141.543 158.768C140.471 159.28 139.231 159.536 137.823 159.536C135.679 159.536 133.911 159.008 132.519 157.952C131.127 156.896 130.255 155.44 129.903 153.584L131.511 152.936C131.783 154.456 132.479 155.648 133.599 156.512C134.735 157.36 136.143 157.784 137.823 157.784C139.663 157.784 141.143 157.304 142.263 156.344C143.383 155.4 143.943 154.176 143.943 152.672C143.943 151.568 143.599 150.68 142.911 150.008C142.239 149.32 141.239 148.784 139.911 148.4L135.495 146.864C134.103 146.4 133.015 145.688 132.231 144.728C131.463 143.768 131.079 142.616 131.079 141.272C131.079 140.12 131.391 139.104 132.015 138.224C132.655 137.328 133.519 136.632 134.607 136.136C135.711 135.624 136.959 135.368 138.351 135.368C140.415 135.368 142.159 135.856 143.583 136.832C145.007 137.808 145.991 139.144 146.535 140.84L145.095 141.56Z" fill="#1A323A"/>
                    <path d="M157.386 137.896V155H155.698V137.896H149.962V136.416H163.122V137.896H157.386Z" fill="#1A323A"/>
                    <path d="M177.159 155L173.183 148.736C172.719 148.8 172.263 148.832 171.815 148.832H168.367V155H166.679V136.416H171.815C173.047 136.416 174.135 136.64 175.079 137.088C176.039 137.536 176.791 138.184 177.335 139.032C177.879 139.864 178.151 140.864 178.151 142.032C178.151 143.296 177.823 144.376 177.167 145.272C176.527 146.152 175.623 146.792 174.455 147.192L178.695 155H177.159ZM168.367 147.352H171.815C173.271 147.352 174.407 146.968 175.223 146.2C176.055 145.432 176.471 144.384 176.471 143.056C176.471 141.776 176.063 140.752 175.247 139.984C174.431 139.2 173.287 138.808 171.815 138.808H168.367V147.352Z" fill="#1A323A"/>
                    <path d="M194.198 147.424C194.198 149.104 193.766 150.504 192.902 151.624C192.038 152.728 190.87 153.552 189.398 154.096C187.942 154.64 186.302 154.912 184.478 154.912C182.542 154.912 180.83 154.624 179.342 154.048C177.854 153.456 176.694 152.592 175.862 151.456C175.046 150.32 174.638 148.944 174.638 147.328V136.416H176.326V147.328C176.326 149.248 176.966 150.736 178.246 151.792C179.542 152.832 181.574 153.352 184.342 153.352C187.11 153.352 189.158 152.84 190.486 151.816C191.814 150.776 192.478 149.312 192.478 147.424V136.416H194.166V147.424H194.198Z" fill="#1A323A"/>
                    <path d="M210.237 137.896H202.029V140.624H210.261V142.104H202.029V153.52H210.717V155H200.341V136.416H210.717V137.896H210.237Z" fill="#1A323A"/>
                    <path d="M219.245 155V136.416H220.933V155H219.245Z" fill="#1A323A"/>
                    <path d="M229.965 155.168C228.269 155.168 226.741 154.768 225.381 153.968C224.021 153.152 222.949 152.024 222.165 150.584C221.397 149.144 221.013 147.504 221.013 145.664C221.013 143.824 221.397 142.192 222.165 140.768C222.949 139.328 224.021 138.208 225.381 137.408C226.741 136.592 228.269 136.184 229.965 136.184C231.661 136.184 233.181 136.592 234.525 137.408C235.885 138.208 236.957 139.328 237.741 140.768C238.525 142.192 238.917 143.824 238.917 145.664C238.917 147.504 238.525 149.144 237.741 150.584C236.957 152.024 235.885 153.152 234.525 153.968C233.181 154.768 231.661 155.168 229.965 155.168ZM229.965 153.632C231.373 153.632 232.637 153.296 233.757 152.624C234.877 151.936 235.757 150.992 236.397 149.792C237.037 148.576 237.357 147.208 237.357 145.688C237.357 144.168 237.037 142.808 236.397 141.608C235.757 140.392 234.877 139.448 233.757 138.776C232.637 138.088 231.373 137.744 229.965 137.744C228.557 137.744 227.285 138.088 226.149 138.776C225.029 139.448 224.149 140.392 223.509 141.608C222.869 142.824 222.549 144.184 222.549 145.688C222.549 147.208 222.869 148.576 223.509 149.792C224.149 150.992 225.029 151.936 226.149 152.624C227.285 153.296 228.557 153.632 229.965 153.632Z" fill="#1A323A"/>
                    <path d="M255.95 155L245.99 139.736V155H244.302V136.416H245.51L255.47 151.68V136.416H257.158V155H255.95Z" fill="#1A323A"/>
                    <path d="M266.238 155V136.416H274.83C276.062 136.416 277.15 136.64 278.094 137.088C279.054 137.536 279.806 138.184 280.35 139.032C280.894 139.864 281.166 140.864 281.166 142.032C281.166 143.216 280.894 144.232 280.35 145.08C279.806 145.912 279.054 146.552 278.094 147C277.15 147.448 276.062 147.672 274.83 147.672H267.926V155H266.238ZM279.51 155L274.35 147.672H276.27L281.454 155H279.51ZM267.926 146.192H274.83C276.286 146.192 277.422 145.808 278.238 145.04C279.07 144.272 279.486 143.248 279.486 141.968C279.486 140.688 279.078 139.672 278.262 138.92C277.446 138.152 276.302 137.768 274.83 137.768H267.926V146.192Z" fill="#1A323A"/>
                    <path d="M295.756 155L291.148 145.616H286.708V155H285.02V136.416H291.604C292.836 136.416 293.924 136.64 294.868 137.088C295.828 137.536 296.58 138.184 297.124 139.032C297.668 139.864 297.94 140.864 297.94 142.032C297.94 143.2 297.668 144.2 297.124 145.032C296.58 145.864 295.828 146.504 294.868 146.952C293.924 147.4 292.836 147.624 291.604 147.624H290.524L295.324 157.12L293.74 157.84L288.756 147.888H290.26L295.324 157.12V155H295.756ZM286.708 144.136H291.604C293.06 144.136 294.196 143.752 295.012 142.984C295.844 142.216 296.26 141.192 296.26 139.912C296.26 138.632 295.852 137.616 295.036 136.864C294.22 136.096 293.076 135.712 291.604 135.712H286.708V144.136Z" fill="#1A323A"/>
                    <path d="M305.451 155.168C303.755 155.168 302.227 154.768 300.867 153.968C299.507 153.152 298.435 152.024 297.651 150.584C296.883 149.144 296.499 147.504 296.499 145.664C296.499 143.824 296.883 142.192 297.651 140.768C298.435 139.328 299.507 138.208 300.867 137.408C302.227 136.592 303.755 136.184 305.451 136.184C307.147 136.184 308.667 136.592 310.011 137.408C311.371 138.208 312.443 139.328 313.227 140.768C314.011 142.192 314.403 143.824 314.403 145.664C314.403 147.504 314.011 149.144 313.227 150.584C312.443 152.024 311.371 153.152 310.011 153.968C308.667 154.768 307.147 155.168 305.451 155.168ZM305.451 153.632C306.859 153.632 308.123 153.296 309.243 152.624C310.363 151.936 311.243 150.992 311.883 149.792C312.523 148.576 312.843 147.208 312.843 145.688C312.843 144.168 312.523 142.808 311.883 141.608C311.243 140.392 310.363 139.448 309.243 138.776C308.123 138.088 306.859 137.744 305.451 137.744C304.043 137.744 302.771 138.088 301.635 138.776C300.515 139.448 299.635 140.392 298.995 141.608C298.355 142.824 298.035 144.184 298.035 145.688C298.035 147.208 298.355 148.576 298.995 149.792C299.635 150.992 300.515 151.936 301.635 152.624C302.771 153.296 304.043 153.632 305.451 153.632Z" fill="#1A323A"/>
                    <path d="M373.816 32C368.349 47.2 358.083 82.1333 332.016 124H361.216C367.683 112 376.683 93.8667 388.216 69.6C398.949 93.8667 407.149 112 412.816 124H416C390.749 82.1333 381.016 47.2 375.816 32H373.816Z" fill="#667EEA"/>
                </svg>
                <div class="commessa-text">COMMESSA 162</div>
            </div>
            <div class="logo">
                <h1>Team Manager</h1>
                <p>Accedi al tuo account</p>
            </div>
            <div id="messageArea" class="message"></div>
            <div class="input-group">
                <label for="usernameInput">Username</label>
                <input type="text" id="usernameInput" autocomplete="username">
            </div>
            <div class="input-group">
                <label for="passwordInput">Password</label>
                <input type="password" id="passwordInput" autocomplete="current-password">
            </div>
            <button id="loginButton">Accedi</button>
        </div>
    </div>

    <!-- DASHBOARD SCREEN -->
    <div id="dashboardScreen">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>🎯 Dashboard Manager</h1>
                    <p>Gestisci il tuo team e progetti</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">AM</div>
                    <div>
                        <div id="userDisplayName">Admin Manager</div>
                        <button onclick="logout()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-container">
            <!-- STATISTICHE -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Attività Totali</h3>
                    <div class="value" id="totalTasks">0</div>
                </div>
                <div class="stat-card">
                    <h3>In Corso</h3>
                    <div class="value" id="inProgressTasks">0</div>
                </div>
                <div class="stat-card">
                    <h3>Completate</h3>
                    <div class="value" id="completedTasks">0</div>
                </div>
                <div class="stat-card">
                    <h3>Membri Team</h3>
                    <div class="value" id="totalMembers">0</div>
                </div>
            </div>

            <!-- GANTT CHART -->
            <div class="section-card">
                <div class="section-header">
                    <div>
                        <h2>📊 Gantt Chart - Progetti Team</h2>
                        <p id="ganttSubtitle">Panoramica completa di tutte le attività del team</p>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-secondary" onclick="testGoogleScriptConnection()">🔧 Test Connessione</button>
                        <button class="btn btn-primary" onclick="refreshData()">🔄 Aggiorna</button>
                    </div>
                </div>
                <div class="manager-only show">
                    <div class="filter-controls" style="padding: 20px; padding-bottom: 0;">
                        <span style="font-weight: 500; color: #1e293b;">Visualizza:</span>
                        <button class="filter-toggle active" id="showActiveBtn" onclick="toggleTaskView('active')">Attività in Corso</button>
                        <button class="filter-toggle" id="showCompletedBtn" onclick="toggleTaskView('completed')">Attività Completate</button>
                    </div>
                </div>
                <div class="gantt-area">
                    <div class="gantt-container" id="ganttContainer"></div>
                </div>
            </div>

            <!-- SEZIONE ATTIVITÀ UTENTE (SOLO MEMBRI) -->
            <div class="section-card member-only">
                <div class="section-header">
                    <div>
                        <h2>✅ Le Mie Attività</h2>
                        <p>Gestisci le attività a te assegnate</p>
                    </div>
                </div>
                <div class="user-tasks-container">
                    <div id="userTasksList"></div>
                </div>
            </div>

            <!-- GESTIONE ATTIVITÀ (SOLO MANAGER) -->
            <div class="section-card manager-only">
                <div class="section-header">
                    <div>
                        <h2>📋 Gestione Attività</h2>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-success" onclick="exportToExcel()">📊 Esporta Excel</button>
                        <button class="btn btn-primary" onclick="openAddTaskModal()">➕ Nuova Attività</button>
                    </div>
                </div>
                <div class="tasks-table-container">
                    <table class="tasks-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Username</th>
                                <th>Attività</th>
                                <th>Azioni</th>
                            </tr>
                                <th>Nome</th>
                                <th>Membri</th>
                                <th>Date</th>
                                <th>Stato</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- GESTIONE MEMBRI (SOLO MANAGER) -->
            <div class="section-card manager-only">
                <div class="section-header">
                    <div>
                        <h2>👥 Gestione Membri</h2>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddMemberModal()">➕ Aggiungi Membro</button>
                    </div>
                </div>
                <div class="members-table-container">
                    <table class="members-table">
                        <thead>
                            <tr>